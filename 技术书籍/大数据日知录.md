作者： 张俊林                        
阅读日期：20250904——20250930
学习方式：书本阅读

# 前言

本书专注于与大数据处理有关的架构与算法。

# 目录

第0章——当谈论大数据时我们在谈什么
第1章——数据分片与路由
第2章——数据复制与一致性
第3章——大数据常用的算法与数据结构
第4章——集群资源管理与调度
第5章——分布式协调系统
第6章——分布式通信
第7章——数据通道
第8章——分布式文件系统
第9章——内存KV数据库
第10章——列式数据库
第11章——大规模批处理系统
第12章——流式计算
第13章——交互式数据分析
第14章——图数据库：架构与算法
第15章——机器学习：范型与架构
第16章——机器学习：分布式算法
第17章——增量计算

# 第0章——当谈论大数据时我们在谈什么

## 大数据是什么

多大才算大：数据量的衡量单位，从小到大依次为KB、MB、GB、TB、PB、EP和ZB

电子数据正在暴涨：2010年全世界信息总量是1ZB，最近3年人类产生的信息量已经超过了之前历史上人类产生的所有信息之和。

大数据的定义：
- 维基百科：数据量太大，手头的工具已经不便于管理
- IBM：3V（Volume、Velocity、Variety）+1V（Value）
- IDC：代表新一代的技术脚骨，能够高速获取数据进行分析挖掘，抽取价值信息
- Google：海量数据可广泛获得，所稀缺的是如何从中挖掘出智慧和观点。

## 大数据之翼：技术范型转换

关系型数据库——>并行数据库——>NoSql数据库

整体架构：
——>数据源
来源各异，形式不规整
——>数据管理
NoSQL不追求应用场景的统一，而且不同类型不同NoSQL库存储管理
——>数据分析
挖掘分析，利用数据挖掘、机器学习、时序分析
——>数据获取
数据可视化展现

大数据技术处理架构图
![[Pasted image 20250904182932.jpg]]

## 大数据商业炼金术

互联网、传统IT、金融、零售行业都在利于大数据提升企业收益

## 大数据在路上

概念最早由麦肯锡提出，巨型公司提供基础架构平台，中小型创业公司完善分布式计算生态系统，或者提供大数据服务等。

# 第1章——数据分片与路由

数据规模越来越大：
- 并行数据库通过纵向扩展解决问题（Scale Up），扩展机器
- 大数据系统通过横向扩展解决问题（Scale Out），增加机器

增加机器就带来了**数据分片**，分片后就必须找到数据，即**数据路由**。

- 数据分片：实现水平扩展
- 数据复制：保证数据高可用，因为服务器经常存在故障，所以需要存储多份副本

数据复制面临的问题：并发对数据更新时，如何保证数据的一致性。

常见的数据分片方法包括哈希分片与范围分片，先讲通用模型再将具体实现。

## 抽象模型

二级映射：第一级：key-partition，一个分片包含多个数据记录；第二级：partition-machine，一个物理机器容纳多个数据分片。

![[Pasted image 20250904184458.jpg]]

在做数据分片时，根据key-partition映射关系将大数据水平切割成众多数据分片，然后再按照partition-machine映射关系将数据分片放置到对应的物理机器上。

- 哈希分片：主要通过哈希函数来建立key-partition映射关系，**点查询**，不支持范围查询。Dynamo、Cassandra、Riak、Voldmort、Membase等都支持
- 范围分片：**支持点查询也可以支持范围查询**，包括Google的BigTable和微软的Azure等系统

## 哈希分片

通过哈希函数分片，有三种哈希分片方式：Round Robin、虚拟桶及一致性哈希方法
### **Round Robin**
就是哈希取模法，哈希函数：H(key) = hash(key) mod K。机器编号0-K-1，全部数据分配到K台物理机。

- 优点：非常简单
- 缺点：灵活性差，增加一个节点，就需要重分布

它是物理机和数据分片的二合一，机器和映射函数紧耦合，这是缺乏扩展灵活性的根本原因。

### 虚拟桶

MemBase对于数据分片管理提出了虚拟桶的实现方式：
记录和物理机引入虚拟桶，数据线到桶，再到物理机，都是多对一的映射。

虚拟桶层就是数据分片层，key-partition映射采用哈希函数，而partition-machine映射采用表格管理实现。
![[Pasted image 20250905104631.jpg]]
系统灵活性、扩展性更强

### 一致性哈希

分布式哈希表：哈希表的分布式扩展。
一致性哈希就是分布式哈希的一种实现方式。

“一致性哈希”算法将哈希数值空间按照大小组成一个首尾相接的环状序列。对于每台机器，可以根据其IP和端口号经过哈希函数映射到哈希数值空间内，这样不同的机器就成了环状序列中的不同节点。
![[Pasted image 20250908145043.jpg]]
**路由方面**：可以在每个机器节点配置路由表，路由表存储m 条路由信息，其中第i 项（0≤i ≤m −1）路由信息代表距离当前节点为2 i 的哈希空间数值所在的机器节点编号。
通常情况下，路由算法发送的消息不会多于m 条，因为这个过程类似于在0～(2 m −1)数值空间上的二分查找法。

**扩展方面**：首先增加节点对应的前驱和后继节点关系，然后还需要进行数据重分布。并发情况下需要进行稳定性检测。

**离开方面**：正常离开进行通知准备，进行数据重分布，异常离开通过数据多副本保障。

**虚拟节点**：两个问题，节点到环状结构的位置随机，容易存在负载不均衡的问题，另外不同机器间的性能也不同。所以引入虚拟节点，即将一个物理节点虚拟成若干虚拟节点，分别映射到一致性哈希的环状结构不同位置。这样一方面可以导致更佳的负载均衡，也可以兼顾到机器异质性问题。

**一致性哈希**：将集群机器数目这一变量从哈希函数中移出，转而将机器及记录主键都映射到哈希数值空间，解除了机器与数据分布函数之间的直接耦合。大大增强了数据分片的灵活性，但是维护成本很高。

### 范围分片

范围分片首先将所有记录的主键进行排序，然后在排好序的主键空间里将记录划分成数据分片，每个数据分片存储有序的主键空间片段内的所有记录。至于数据分片在物理机的管理方式往往采用LSM树，这是一种高效写入的数据索引结构。

![[Pasted image 20250908175559.jpg]]

很多大规模存储系统都支持上述范围分片模式，比如Yahoo的PNUTS和微软的Azure。Google的BigTable也基本遵循上述模式，不同点在于其数据分片映射表不是单层结构，而是组织成类似B+树的层次结构。

# 第2章——数据分片与路由

大数据领域，增加系统高可用，即将数据进行多副本存储，但是多副本会带来兵法写入的一致性问题。

## 基本原则与设计理念

CAP、BASE、ACID理论

### 原教旨CAP主义

CAP是对“Consistency/Availability/Partition Tolerance”：
- **强一致性**：在分布式系统中的同一数据多副本情形下，对于数据的更新操作体现出的效果与只有单份数据是一样的。
- **可用性**：客户端在任何时刻对大规模数据系统的读／写操作都应该保证在限定延时内完成。
- **分区容忍性**：网络分区通讯有问题，仍然能够继续工作。

1999年Eric Brewer提出该理论，只能实现三个中的两个，一般不舍弃P，故只有AP或CP.

![[Pasted image 20250908180836.jpg]]
- 传统的关系数据库在三要素中选择CA两个因素，即强一致性、高可用性，但是可扩展性与容错性差。
 - NoSQL系统往往更关注AP因素，即高可扩展性和高可用性，但是往往以弱一致性作为代价.


2012年，Eric Brewer又提出P很低概率出现，正常情况下还是要兼顾CAP，在进行差异化、细粒度的CA取舍。修正后的示意图如下，在过程中满足CAP、AP、CAP因素：
![[Pasted image 20250908181729.jpg]]

### ACID原则