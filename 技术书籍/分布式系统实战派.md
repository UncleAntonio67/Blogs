---
tags:
  - 技术书籍
aliases:
  - 分布式系统实战派
time: 20251213——
---

作者：张伟洋                       
阅读日期：202501213——20250
# 目录

**第一篇 后端体系架构认知**
第1章——从单体架构到微服务架构的演变过程
第2章——几张图了解后端系统
第3章——微服务间的交互

**第二篇 分布式技术转向**
第4章——分布式系统的通信机制
第5章——分布式数据库
第6章——典型的分布式存储系统
第7章——分布式事务——确保分布式系统中的数据一致性
第8章——消息中间件——分布式系统中的异步通信利器

**第三篇 高可用和数据安全策略**
第9章——冗余备份——数据的备份和容灾策略
第10章——高可用与异地多活——提高系统的稳定性和故障恢复能力
第四章 分布式系统项目设计
第11章——【项目实现】支持5kw用户同时在线的短视频系统设计
第12章——【项目实战】日均订单量8kw的外卖系统设计

# 第1章 从单体架构到微服务架构的演变过程

## 1.1 什么是单体架构

**单体架构**：将所有的功能模块都放在一个代码库中，作为一个系统进行开发、部署和扩展。
- 优点：简单、一致、开发便捷、部署简单、原子性强
- 缺点：难扩展（垂直扩展）、修改风险大、难以迭代、协作困难、性能瓶颈

使用场景：小型应用、短期项目、快速原型验证

## 1.2 从单体架构到集群架构——多台机器协同

集群架构，单体应用集群化部署，往往由客户端、服务器集群、负载均衡、数据库

- 水平扩展：增加服务器，灵活成本低
- 垂直扩展：增加单个服务器的配置，简单集中成本高

弹性伸缩：动态调整集群规划，根据集群的监控指标，分析预测使用自动化的工具与脚本，定于伸缩策略和阈值。比如k8s等等。

心跳检测：是故障转移策略的核心机制，能够在短时间内发现并处理节点故障，保障服务的持续运行。
故障转移：自动将工作负载从故障转移到其他部分，主动-主动/主动-被动两种模式。

数据库读写分离：读操作和写操作分析，主数据库的写入同步到从库，通过数据库的日志复制机制实现。
- 优点：并发、减轻主库的压力、增加备份、提高可用性
- 问题：数据延迟、复杂性增加、主库依然由写入瓶颈

分布式数据库：将数据分散存储在多个物理位置的数据库系统。高可扩展性、高可用性、数据局部性。

分表：大表分小表，水平（日期）/垂直
分库：数据分散到多个数据库实例，水平（用户id）/垂直

分库分表需要关注：数据一致性、查询变复杂、数据迁移。

## 1.3 从集群架构到微服务架构——精细拆分业务

微服务架构类似于应用层的微分。

微服务的服务划分：
- 业务功能解耦：系统被划分为多个小的、独立的服务
- 独立部署扩展：每个服务独立部署
- 专用数据存储：每个服务都有自己的数据库或存储
- 服务间通信：通过API或消息通信，不直接访问其他服务的数据库
- API网关：使用API网关，将请求路由到适当的后端服务

核心特性：独立性、自治性、多语言支持、分布式通讯、轻量级、容错性、可扩展

微服务的每个服务独立自治，增加架构复杂性，提升开发部署速度及技术栈的灵活性等

微服务架构的基本组件：
- 服务组件：服务、数据库、API网关
- 通讯机制：同步（rest/grpc）异步通讯（Kafka）
- 支持组件：服务注册发现、配置管理、负载均衡、断路器
- 安全性和监控：身份认证授权、日志管理、监控告警
- Devops和自动化：容器化、CICD、编排工具

## 1.4 微服务架构与分布式架构

- 微服务架构是分布式架构的子集，专注于业务功能的划分和服务的自治性
- 分布式架构强调数据和计算的分散

分布式架构的通信往往是节点直接进行的。

分布式架构：分布式、并发性、扩展性、透明性、容错性

分布式架构，应用通过作为一个单一的大型应用进行构建和部署，每个服务器上运行的都是完整的应用副本。对比：

|       | 分布式架构              | 微服务架构            |
| ----- | ------------------ | ---------------- |
| 规模    | 多个计算节点的架构，比如分布式数据库 | 多个业务微服务          |
| 独立性   | 依赖共享资源协作完成，不要求完全自治 | 独立自治             |
| 通信方式  | 采用多种协议和模式、多样化      | 轻量级、Restful、消息队列 |
| 运维复杂性 | 涉及不同类型组件和系统的协同     | 涉及多服务的管理和协调      |
🎈微服务架构是一种特定的分布式架构，强调服务的独立性和小规模化

## 1.5 从单体架构到微服务架构的迁移——让系统更稳定

迁移到微服务架构要考虑的因素：
- 业务需求和规划
- 团队结构
- 技术能力和培训
- 数据一致性和集成

# 第2章 几张图了解后端系统

## 2.1 一张图看懂整个后端系统架构

![[0861e109a1d72ba6e75256b328e9cae.jpg | 400]]
### 2.1.1 CDN（内容分发网络）

**CDN**：一种分布式网络，旨在通过在地理上靠近用户的服务器提供高可用性和高性能的网页内容和其他Web资源，核心功能是缓存内容。

**工作原理**：
第一次请求某个内容，会从源服务器获取内容，并存储到离用户最近的边缘节点。后续访问从边缘节点提供服务。
主要组成及过程：客户端、CDN边缘节点、源服务器、获取资源、返回缓存过程。
可以有效减轻源服务器的负担，加速内容分发速度，提高用户访问网站的体验。

**主要优势**：降低延迟、减轻源服务器负担、提高内容可用性
**应用场景**：网站加速（视频分享服务）、流媒体分发（应对高带宽需求）、软件分发（分发软件更新等等）

### 2.1.2 负载均衡器

**负载均衡器**：一种网络设备或软件，用于在多个服务器之间分配网络或应用流量，主要职责是优化资源使用、最大化吞吐量、最小化响应时间、避免单个服务器过载。

**工作原理**：
- 流量分发：流量到了，根据预定义的规则进行服务分配
- 健康检查：负载均衡器定义对后端服务进行健康检查，保证流量被发到正常运行的服务器。

**主要优势**：防止服务器过载、提高应用的可用性和可靠性、可扩展性。
**应用场景**：网站和Web应用、云计算和大数据应用。

### 2.1.3 API网关

**API网关**：用于管理API之间的请求和通讯，集中处理所有从客户端到后端的API调用。主要功能包括：请求路由、API聚合、身份验证和授权、速率限制、缓存管理等

**工作原理**：
- 请求路由：根据客户端的请求路径、HTTP方法将请求分发到对应服务
- 聚合处理：对于多个服务协作完成的请求，网关聚合多个服务的调用和响应，统一响应
- 安全性和认证：在请求到达各个服务前，进行身份验证和授权检查

与负载均衡器的区别：API网关不仅负责流量路由，还负责请求路由、认证授权、限流配额、协议转换等。小型或简单应用中是可以只使用API网关的。负载均衡有着更专业的流量分配管理能力。

**主要优势**：简化客户端交互、减轻微服务负担、易于监控和维护。
**应用场景**：微服务架构、服务聚合、API管理

### 2.1.4 分布式数据库集群

**分布式数据库集群**：由多个数据库服务器组成的系统，一起工作、存储和管理数据，提供高可用性、可扩展性和高性能。由数据分片、复制、分布式查询处理等主要功能。

**工作原理**：
- 数据分片：数据库的数据被分成多个分片，每个分片在不同的节点，可以并行操作提升处理效率
- 复制：数据副本存储在集群的多个节点上，提高数据的可用性和耐久性。
- 事务处理：处理跨界点的数据，确保数据的一致性和完整性
- 负载均衡：通过在多个节点之间分配负载来提高性能和可靠性。
- 一致性和协调：保证数据在所有节点之间保持一致。

**主要优势**：可扩展、高可用、负载均衡
**应用场景**：大数据处理、高并发应用、全球化部署

### 2.1.5 分布式消息集群

**分布式消息集群**：由一系列消息队列组成，这些队列在不同的服务器或服务实现上运行，允许系统内的不同组件异步地进行通信和交换数据，有助于解耦应用的不同部分，提高效率和可靠性。

**工作原理**：
- 消息产生：执行操作产生消息，发送到对应的消息队列
- 消息存储：消息队列暂存消息，直到由消费者来消费它
- 消息消费：另一端的服务订阅消息队列

**应用场景**：电商系统用户下单、营销活动等等

### 2.1.6 分布式缓存集群

**分布式缓存集群**：用于在多个服务器或节点上存储和管理缓存数据，以提高应用的性能和可扩展性。主要作用由：提高数据访问速度、减轻数据库负担、提高系统的可扩展性。

**工作原理**：
- 数据存储和检索、缓存更新和失效、负载均衡、高可用性。

**应用场景**：页面加速、减少数据库负载、会话管理

与CDN的区别：都是为了提高数据访问速度和性能，但是略有不同：
- 内容：缓存集群存动态内容，CDN存储静态内容
- 位置：缓存集群数据在内存中，靠近服务器，CDN在多个数据中心提供服务
- 目的：缓存集群式为了减少对数据库的直接访问，CDN的目的是减少带宽使用，提供静态内容访问速度

### 2.1.7 分布式文件集群

**分布式文件集群**：一种数据存储架构，将文件数据存储在网络中的多个节点上，提高数据的可靠性、可用性和访问效率。可以存大量文件、确保数据的持久性和可靠性，支持分布式计算。

**工作原理**：
文件存储和管理、高可用和容错性、负载均衡和性能提升。

**应用场景**：在电商系统里存储商品图片和视频、管理用户上传的内容、备份和恢复。

### 2.1.8 分布式搜索集群

**分布式搜索集群**：搜索大规模数据集中的信息，支持复杂查询，快速返回结果。

**工作原理**：存储数据、索引数据、负载均衡、聚合搜索结果。

**应用场景**：在电商系统中搜索商品、提供实时分析报告、实现个性化的推荐。

### 2.1.9 服务配置和管理

**服务配置和管理**：
- 服务配置：统一管理和维护所有服务的设置，包括数据库的连接信息、外部API的密钥；可以利用服务配置动态调整服务的运行时行为。
- 服务管理：确保服务稳定运行，并根据流量和用户需求动态分配资源。

### 2.1.10 服务注册与发现

- **服务注册**：每个服务启动，都要在注册中心等级信息，实时更新服务的状态信息。
- **服务发现**：其他服务可以通过服务发现查询服务注册中心，找到交互服务实力的详细信息，可以支持灵活的找到服务实例。

### 2.1.11 服务治理与监控

- **服务治理**：规范服务的行为，定义如何管理和控制服务，去报服务的质量，保障服务稳定、可靠
- **服务监控**：实时监控服务健康，故障诊断和预警。

### 2.1.12 服务追踪

- **服务追踪**：全面了解请求流程，追踪数据进行性能瓶颈分析以及故障定位。
- **应用**：比如电商促销时用户结账发生延迟，可以进行分析。

## 2.2 一张图看懂分布式架构的组成



## 2.3 一张图看懂本书的核心内容














